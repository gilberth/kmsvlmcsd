# vlmcsd - KMS Emulator

vlmcsd is a KMS (Key Management Service) emulator that can be used to activate Microsoft Windows and Office products. It emulates a KMS server on your local network, allowing clients to activate their software without connecting to Microsoft's servers.

## Features

- Lightweight KMS server emulation
- Supports Windows and Office activation
- Cross-platform compatibility (Windows, Linux, macOS)
- Docker support for containerized deployment
- Minimal resource usage
- No external dependencies required

## Building from Source

### Prerequisites

- GCC or compatible C compiler
- Make build system
- OpenSSL development libraries (optional, for enhanced security)

### Build Instructions

#### Standard Build
```bash
make
```

#### Build with OpenSSL support
```bash
make FEATURES=full
```

#### Clean build
```bash
make clean
make
```

The compiled binaries will be available in the project directory:
- `vlmcsd` - The KMS server daemon
- `vlmcs` - KMS client for testing
- `vlmcsdmulti` - Multi-call binary

## Installation

### Manual Installation
1. Copy the compiled `vlmcsd` binary to your preferred location (e.g., `/usr/local/bin/`)
2. Copy the configuration file `etc/vlmcsd.ini` to `/etc/vlmcsd.ini` if needed
3. Set appropriate permissions: `chmod +x /usr/local/bin/vlmcsd`

### Using Package Managers
Check if your distribution provides vlmcsd packages through its package manager.

## Usage

### Basic Usage

#### Start the KMS server
```bash
./vlmcsd
```

#### Start with custom configuration
```bash
./vlmcsd -i /path/to/vlmcsd.ini
```

#### Run in foreground (for debugging)
```bash
./vlmcsd -D
```

#### Test the server
```bash
./vlmcs -v
```

### Configuration

The server can be configured using command-line options or a configuration file:

- Configuration file: `etc/vlmcsd.ini`
- Key database: `etc/vlmcsd.kmd`

Common options:
- `-p <port>` - Set listening port (default: 1688)
- `-l <address>` - Set listening address
- `-v` - Verbose output
- `-D` - Run in foreground

### Client Activation

Once vlmcsd is running, clients can activate using:

#### Windows
```cmd
slmgr /skms <server-ip>:1688
slmgr /ato
```

#### Office
```cmd
cscript "C:\Program Files\Microsoft Office\OfficeXX\ospp.vbs" /sethst:<server-ip>
cscript "C:\Program Files\Microsoft Office\OfficeXX\ospp.vbs" /act
```

## üê≥ Docker Deployment

### Quick Start

Pull and run the latest KMS server with SSL support:

```bash
# Pull the image
docker pull ghcr.io/gilberth/kms:latest

# Run with auto-restart
docker run -d \
  --name vlmcsd \
  --restart unless-stopped \
  -p 1688:1688 \
  ghcr.io/gilberth/kms:latest
```

### üöÄ One-Line Deployment
```bash
docker run -d --name vlmcsd --restart unless-stopped -p 1688:1688 ghcr.io/gilberth/kms:latest
```

### üõ†Ô∏è Advanced Configuration

**With custom configuration:**
```bash
docker run -d \
  --name vlmcsd \
  --restart unless-stopped \
  -p 1688:1688 \
  -v /path/to/vlmcsd.ini:/etc/vlmcsd.ini:ro \
  ghcr.io/gilberth/kms:latest
```

**With custom port:**
```bash
docker run -d \
  --name vlmcsd \
  --restart unless-stopped \
  -p 1689:1688 \
  ghcr.io/gilberth/kms:latest
```

**With logs:**
```bash
# View logs
docker logs vlmcsd

# Follow logs in real-time
docker logs -f vlmcsd
```

### üìä Container Management

```bash
# Check status
docker ps

# Stop the server
docker stop vlmcsd

# Start the server
docker start vlmcsd

# Restart the server
docker restart vlmcsd

# Remove container
docker rm vlmcsd
```

### ‚úÖ Test the Server

```bash
# Test with included client
docker exec vlmcsd /usr/bin/vlmcs -v localhost

# Test from host (if vlmcs is installed)
vlmcs -v localhost
```

### üîß Docker Compose

Create a `docker-compose.yml` file:

```yaml
version: '3.8'
services:
  vlmcsd:
    image: ghcr.io/gilberth/kms:latest
    container_name: vlmcsd
    restart: unless-stopped
    ports:
      - "1688:1688"
    # Optional: mount custom config
    # volumes:
    #   - ./vlmcsd.ini:/etc/vlmcsd.ini:ro
```

Then run:
```bash
docker-compose up -d
```

---

**üîí This image includes SSL support and enhanced security features built from `Dockerfile.secure`.**

## Documentation

For detailed documentation, use the man pages:

```bash
man man/vlmcsd.8    # vlmcsd server documentation
man man/vlmcs.1     # vlmcs client documentation  
man man/vlmcsd.7    # General KMS documentation
man man/vlmcsd.ini.5 # Configuration file format
```

If you don't have man installed, you can also use the .txt, .html and .pdf files
in the man directory.

## Security Considerations

Please review the `SECURITY-ANALYSIS.md` file for important security considerations before deploying vlmcsd in production environments.

## Legal Notice

This software is for educational and testing purposes only. Users are responsible for ensuring compliance with Microsoft's licensing terms and applicable laws in their jurisdiction.

## Contributing

Contributions are welcome! Please ensure your code follows the existing style and includes appropriate documentation.

## License

See the source code files for licensing information.
